%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Functions}
\label{sec:function-declaration}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RuleDef{function declarations}{
  \Literal{functions}, \Sequence{\RuleRef{function definition}}
}

\RuleDef{function definition}{
    \RuleRef{explicit function definition} \\
    \Alt\ \RuleRef{implicit function definition}
}

\RuleDef{explicit function definition}{
  \Optional{\RuleRef{qualifier}}, 
  \RuleRef{identifier}, \Literal{:}, \RuleRef{function type}, \\
  \RuleRef{identifier}, \RuleRef{parameters list}, \Literal{==}, \RuleRef{function body}, \\
  \Optional{\Literal{pre}, \RuleRef{expression}}, \\
  \Optional{\Literal{post}, \RuleRef{expression}}, \\
  \Optional{\Literal{measure}, \RuleRef{name}}
}

\RuleDef{parameters list}{
  \RuleRef{parameters}, \Sequence{\RuleRef{parameters}}
}

\RuleDef{parameters}{
  \Literal{(}, \Optional{\RuleRef{pattern list}}, \Literal{)}
}

\RuleDef{implicit function definition}{
  \Optional{\RuleRef{qualifier}}, 
  \RuleRef{identifier}, \RuleRef{parameter types}, \RuleRef{identifier type pair list}, \\ 
  \Optional{\Literal{pre}, \RuleRef{expression}}, 
  \Literal{post}, \RuleRef{expression} 
}

\RuleDef{parameter types}{
    \Literal{(}, \Optional{\CommaSepList{\RuleRef{pattern list}, \Literal{:}, \RuleRef{type}}}, \Literal{)}
}

\RuleDef{identifier type pair list}{
    \CommaSepList{\RuleRef{identifier},\Literal{:},\RuleRef{type}}
}

\RuleDef{function body}{
  \RuleRef{expression} \\
  \Alt\ \Literal{is not yet specified} \\
  \Alt\ \Literal{is subclass responsibility}
}

% \begin{verbatim}
% functions
%     public sqrt (x: real) r: real
%     pre x >= 0
%     post r*r = x;

%     public quadratic: int*int*int -> int*int
%     quadratic(a,b,c) == let delta = b*b - 4*a*c in
% 	   mk_((-b+sqrt(delta))/2*a,(-b-sqrt(delta))/2*a)
%     pre b*b -4*a*c >= 0;

%     public quadratic2 (a: int, b: int, c: int) r1: int, r2: int
%     pre b*b-4*a*c >= 0
%     post a*r1*r1+b*r1+c=0 and a*r2*r2+b*r2+c=0;
% \end{verbatim}

